import{a as j,f as b,u as y,j as t,c as S,r as m}from"./index-Ns7O1-GI.js";async function w(e){return(await j.get("/stats/general",{params:{start:e.start,end:e.end},headers:{Authorization:`Bearer ${b()}`}})).data}async function D(e){return(await j.get("/stats/reading-graph",{params:{start:e.start,end:e.end},headers:{Authorization:`Bearer ${b()}`}})).data}const f={getGeneralStats:w,getReadingGraph:D},N=()=>e=>y({queryKey:[`stats-general-${e.start}-${e.end}`],queryFn:()=>f.getGeneralStats(e)}),v=()=>e=>y({queryKey:[`stats-reading-graph-${e.start}-${e.end}`],queryFn:()=>f.getReadingGraph(e)});function k({start:e,end:r}){const n=v()({start:e,end:r}),p=new Date(e),l=new Date(r),o={},h={Sun:[],Mon:[],Tue:[],Wed:[],Thu:[],Fri:[],Sat:[]};if(n.data&&!n.isFetching&&!n.isLoading){const a=n.data.min,i=n.data.max;for(let s=p;s<=l;s.setDate(s.getDate()+1)){const g=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][s.getDay()],c=s.toISOString().split("T")[0],d=n.data.days[c];let u=0;d>0&&(u=Math.ceil((d-a)/(i-a)*5),u=Math.max(1,Math.min(5,u))),h[g].push({date:c,intensity:u,pages:d||0})}for(let s=0;s<h.Sun.length;s++){const g=new Date(h.Sun[s].date),d=`${g.toLocaleString("default",{month:"short"})}-${g.getFullYear()}`;o[d]=o[d]?o[d]+1:1}}else return t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-bold",children:"Reading Graph"}),t.jsx("div",{children:"Loading..."})]});return t.jsxs("div",{children:[t.jsxs("h2",{className:"text-lg font-bold",children:["Reading Graph ",n.data.total?`- ${n.data.total} pages`:""]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"table-fixed",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("td",{}),Object.keys(o).map(a=>t.jsx("td",{className:"text-sm",colSpan:o[a],children:a.split("-")[0]},a))]})}),t.jsx("tbody",{children:Object.keys(h).map(a=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-sm min-h-6 h-6 pr-1",children:a}),h[a].map((i,s)=>t.jsxs(t.Fragment,{children:[s==0&&G(i.date,a,h)?t.jsx("td",{}):null,t.jsx("td",{className:`min-w-6 w-6 p-0 border ${O(i.intensity)}`,title:i.date})]},s))]},a))})]})})]})}function G(e,r,x){const n=new Date(e),p=Object.keys(x).indexOf(r);for(let l=p;l<Object.keys(x).length;l++){const o=new Date(x[Object.keys(x)[l]][0].date);if(n.getTime()>o.getTime())return!0}return!1}function O(e){return e===1?"bg-cyan-100":e===2?"bg-cyan-200":e===3?"bg-cyan-300":e===4?"bg-cyan-400":e===5?"bg-cyan-500":""}const F=S("/stats")({component:R});function R(){var s,g;const e=new Date().getFullYear(),[r,x]=m.useState(new Date(e,0,1).toISOString().split("T")[0]),[n,p]=m.useState(new Date(e,11,31).toISOString().split("T")[0]),[l,o]=m.useState({start:r,end:n}),a=N()(l),i=c=>{const d=new Date,u=new Date(d.setMonth(d.getMonth()-c));x(u.toISOString().split("T")[0]),p(new Date().toISOString().split("T")[0]),o({start:u.toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]})};return t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl text-center",children:"Your Statistics"}),t.jsx("hr",{}),t.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"date",value:r,onChange:c=>x(c.target.value),className:"w-full text-xs border-2 rounded-md py-1 px-2 focus:border-gray-200 h-[34px]"}),t.jsx("div",{className:"text-gray-400 text-sm",children:"â†’"}),t.jsx("input",{type:"date",value:n,onChange:c=>p(c.target.value),className:"w-full text-xs border-2 rounded-md py-1 px-2 focus:border-gray-200 h-[34px]"}),t.jsx("button",{onClick:()=>o({start:r,end:n}),className:"w-full text-xs border-2 rounded-md py-1 px-2 bg-white hover:bg-gray-200 transition duration-250 h-[34px]",children:"Update"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>i(1),className:"flex-1 text-xs border-2 rounded-md py-1 px-2 bg-white hover:bg-gray-200 transition duration-250",children:"Last Month"}),t.jsx("button",{onClick:()=>i(3),className:"flex-1 text-xs border-2 rounded-md py-1 px-2 bg-white hover:bg-gray-200 transition duration-250",children:"Last 3 Months"}),t.jsx("button",{onClick:()=>i(6),className:"flex-1 text-xs border-2 rounded-md py-1 px-2 bg-white hover:bg-gray-200 transition duration-250",children:"Last 6 Months"}),t.jsx("button",{onClick:()=>i(12),className:"flex-1 text-xs border-2 rounded-md py-1 px-2 bg-white hover:bg-gray-200 transition duration-250",children:"Last Year"})]}),a.isLoading||a.isFetching?t.jsx("div",{children:"Loading..."}):(s=a.data)!=null&&s.total_books&&((g=a.data)!=null&&g.total_pages)?t.jsxs("div",{children:[t.jsxs("div",{className:"flex text-center items-center gap-2",children:[t.jsxs("p",{className:"w-full",children:["Books ",t.jsx("strong",{children:a.data.total_books})]}),t.jsxs("p",{className:"w-full",children:["Pages ",t.jsx("strong",{children:a.data.total_pages})]})]}),t.jsx("p",{className:"text-sm text-center",children:t.jsx("i",{children:"page count may be inaccurate due to book data quality"})})]}):null]}),t.jsx("br",{}),t.jsx("div",{className:"flex flex-col gap-2",children:t.jsx(k,{start:l.start,end:l.end})})]})}export{F as Route};
