import{u as h,j as e,a as i,r as l,L as m,S as g,b as p,R as f,c as j,f as b,d as v,F as y,e as N}from"./index-Bs5p3MiU.js";function w(){const t=h();return e.jsx("button",{className:"border-2 rounded-md py-1 px-2 font-medium bg-slate-200 hover:bg-gray-200 transition duration-250",onClick:()=>t.mutate(),children:"Logout"})}function S(){const{haveRead:t}=i();return e.jsxs("div",{className:"border rounded-md",children:[e.jsxs("h2",{className:"text-lg font-medium bg-slate-200 p-2",children:["You have read ",t.data?`${t.data.length} books`:null]}),t.data&&t.data.length>0?e.jsx("div",{className:"grid grid-cols-2 xxxs:grid-cols-3 xxs:grid-cols-4 xs:grid-cols-4 sm:grid-cols-6 md:grid-cols-7 gap-2 p-2",children:t.data.map((s,r)=>k(s,r))}):e.jsx("div",{className:"p-2",children:"You have not added any of the books you have read."})]})}function k(t,s){const{book:r,review:a}=t,[n,c]=l.useState(!1),o=new Date(a.read_date).toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"});return e.jsxs("div",{className:"flex gap-1 flex-col items-center",children:[e.jsx(m,{to:"/book/$isbn",params:{isbn:r.isbn13},className:"flex items-center h-28",children:n||!r.coverUrl?e.jsx("div",{className:"w-20 max-w-20 h-full border-2 flex items-center justify-center text-xs text-center p-2 overflow-hidden",children:r.title}):e.jsx("img",{src:r.coverUrl,title:r.title,alt:r.title,className:"w-20 max-w-20 h-full object-scale-down",onError:()=>c(!0)},r.isbn13)}),a.rating&&a.rating>0?e.jsx(g,{rating:a.rating||0,overrideStarClass:"w-4 h-4"}):null,e.jsx("p",{className:"text-xs text-gray-400 mt-auto",children:o})]},s)}function E(){const{toRead:t}=i(),s=p(),r=()=>{const a=t.data;if(!a)return;const n=a[Math.floor(Math.random()*a.length)];s({to:"/book/$isbn",params:{isbn:n.isbn13}})};return e.jsxs("div",{className:"border rounded-md",children:[e.jsxs("h2",{className:"text-lg font-medium bg-slate-200 p-2",children:["You want to read ",t.data?`${t.data.length} books`:null,t.data&&t.data.length>0?e.jsxs(e.Fragment,{children:[" ",e.jsx("button",{onClick:r,children:"ðŸŽ²"})]}):null]}),t.data&&t.data.length>0?e.jsx("div",{className:"flex items-center gap-2 p-2 overflow-x-auto overflow-y-hidden",children:t.data.map(a=>I(a))}):e.jsx("div",{className:"p-2",children:"You have not added any books to be read."})]})}function I(t){const[s,r]=l.useState(!1);return e.jsx(m,{to:"/book/$isbn",params:{isbn:t.isbn13},className:"flex items-center h-28",children:s||!t.coverUrl?e.jsx("div",{className:"w-20 max-w-20 h-full border-2 flex items-center justify-center text-xs text-center p-2 overflow-hidden",children:t.title}):e.jsx("img",{src:t.coverUrl,title:t.title,alt:t.title,className:"w-20 max-w-20 h-full object-scale-down",onError:()=>r(!0)},t.isbn13)},t.isbn13)}function R(){const{reading:t}=i();return e.jsxs("div",{className:"border rounded-md",children:[e.jsxs("h2",{className:"text-lg font-medium bg-slate-200 p-2",children:["You are reading ",t.data?`${t.data.length} books`:null]}),t.data&&t.data.length>0?e.jsx("div",{className:"flex flex-col gap-2 p-2",children:t.data.map(s=>$(s))}):e.jsx("div",{className:"p-2",children:"Currently not reading any books..."})]})}function $(t){const{book:s}=t,[r,a]=l.useState(!1);return e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(m,{to:"/book/$isbn",params:{isbn:s.isbn13},className:"basis-1/5 h-32",children:r||!s.coverUrl?e.jsx("div",{className:"w-20 max-w-20 h-full border-2 flex items-center justify-center text-xs text-center p-2 overflow-hidden",children:s.title}):e.jsx("img",{src:s.coverUrl,title:s.title,alt:s.title,className:"w-20 max-w-20 h-full object-scale-down m-auto",onError:()=>a(!0)},s.isbn13)}),e.jsxs("div",{className:"flex flex-col grow basis-4/5",children:[e.jsx("h3",{className:"text-md",children:s.title}),e.jsx("h4",{className:"text-sm mb-1",children:s.authors.join(",")}),e.jsx(f,{bookReading:t,size:"xs"})]})]},s.isbn13)}async function C(t){return(await j.post("/import",t,{headers:{Authorization:`Bearer ${b()}`}})).data}const G={importStoryGraph:C},L=()=>v({mutationFn:G.importStoryGraph,onSuccess:()=>{console.log("Started import from StoryGraph.")}});function U(){const t=L(),[s,r]=l.useState(""),[a,n]=l.useState(""),c=async o=>{var u;const d=(u=o.target.files)==null?void 0:u[0];if(r(""),!d){r("No file selected.");return}if(d.type!=="text/csv"){r("Invalid file type. Please select a .csv file.");return}const x=await t.mutateAsync(d);x?n(`Import has started, here is your import ID: ${x.import_id}. Your books will appear over time.`):r("Something went wrong when importing from story graph.")};return e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:".csv",style:{display:"none"},onChange:c,id:"fileInput"}),e.jsx("button",{className:"w-full border-2 rounded-md py-1 px-2 font-medium bg-slate-200 hover:bg-gray-200 transition duration-250",onClick:()=>{var o;return(o=document.getElementById("fileInput"))==null?void 0:o.click()},children:"Import from StoryGraph"}),s!==""?e.jsx(y,{errorMessage:s}):null,a!==""?e.jsx("div",{className:"text-green-700 text-sm",children:a}):null]})}const Y=N("/")({component:B});function B(){var s;const{user:t}=i();return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("h1",{className:"text-xl text-center",children:["Welcome back, ",e.jsx("strong",{children:(s=t.data)==null?void 0:s.handle}),"! ðŸ‘‹"]}),e.jsx(R,{}),e.jsx(E,{}),e.jsx(S,{}),e.jsx("hr",{}),e.jsx(U,{}),e.jsx("hr",{}),e.jsx(w,{})]})}export{Y as Route};
