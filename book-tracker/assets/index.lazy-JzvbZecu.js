import{u as p,j as e,a as i,L as c,C as m,S as g,b,R as j,c as f,f as v,d as y,r as h,F as N,e as k}from"./index-CMO_qPK1.js";function w(){const s=p();return e.jsx("button",{className:"border-2 rounded-md py-1 px-2 font-medium bg-slate-200 hover:bg-gray-200 transition duration-250",onClick:()=>s.mutate(),children:"Logout"})}function S(){const{haveRead:s}=i();return e.jsxs("div",{className:"border rounded-md",children:[e.jsxs("h2",{className:"text-lg font-medium bg-slate-200 p-2",children:["You have read ",s.data?`${s.data.length} books`:null]}),s.data&&s.data.length>0?e.jsx("div",{className:"grid grid-cols-2 xxxs:grid-cols-3 xxs:grid-cols-4 xs:grid-cols-4 sm:grid-cols-6 md:grid-cols-7 gap-2 p-2",children:s.data.map((t,a)=>R(t,a))}):e.jsx("div",{className:"p-2",children:"You have not added any of the books you have read."})]})}function R(s,t){const{book:a,review:r}=s,o=new Date(r.read_date).toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"});return e.jsxs("div",{className:"flex gap-1 flex-col items-center",children:[e.jsx(c,{to:"/book/$isbn",params:{isbn:a.isbn13},children:e.jsx("div",{className:"flex items-center h-24 ",children:e.jsx("img",{src:a.coverUrl,title:a.title,alt:a.title,className:"h-full object-scale-down",onError:({currentTarget:n})=>{n.onerror=null,n.src=m}})})}),r.rating&&r.rating>0?e.jsx(g,{rating:r.rating||0,overrideStarClass:"w-4 h-4"}):null,e.jsx("p",{className:"text-xs text-gray-400 mt-auto",children:o})]},t)}function I(){const{toRead:s}=i(),t=b(),a=()=>{const r=s.data;if(!r)return;const o=r[Math.floor(Math.random()*r.length)];t({to:"/book/$isbn",params:{isbn:o.isbn13}})};return e.jsxs("div",{className:"border rounded-md",children:[e.jsxs("h2",{className:"text-lg font-medium bg-slate-200 p-2",children:["You want to read ",s.data?`${s.data.length} books`:null,s.data&&s.data.length>0?e.jsxs(e.Fragment,{children:[" ",e.jsx("button",{onClick:a,children:"ðŸŽ²"})]}):null]}),s.data&&s.data.length>0?e.jsx("div",{className:"flex items-center gap-2 p-2 overflow-x-auto overflow-y-hidden",children:s.data.map(r=>C(r))}):e.jsx("div",{className:"p-2",children:"You have not added any books to be read."})]})}function C(s){return e.jsx(c,{to:"/book/$isbn",params:{isbn:s.isbn13},children:e.jsx("img",{src:s.coverUrl,title:s.title,alt:s.title,className:"w-16 max-w-16 object-scale-down",onError:({currentTarget:t})=>{t.onerror=null,t.src=m}},s.isbn13)},s.isbn13)}function $(){const{reading:s}=i();return e.jsxs("div",{className:"border rounded-md",children:[e.jsxs("h2",{className:"text-lg font-medium bg-slate-200 p-2",children:["You are reading ",s.data?`${s.data.length} books`:null]}),s.data&&s.data.length>0?e.jsx("div",{className:"flex flex-col gap-2 p-2",children:s.data.map(t=>E(t))}):e.jsx("div",{className:"p-2",children:"Currently not reading any books..."})]})}function E(s){const{book:t}=s;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{to:"/book/$isbn",params:{isbn:t.isbn13},className:"basis-1/5",children:e.jsx("img",{src:t.coverUrl,title:t.title,alt:t.title,className:"w-20 object-scale-down m-auto mb-auto",onError:({currentTarget:a})=>{a.onerror=null,a.src=m}})}),e.jsxs("div",{className:"flex flex-col grow basis-4/5",children:[e.jsx("h3",{className:"text-md",children:t.title}),e.jsx("h4",{className:"text-sm mb-1",children:t.authors.join(",")}),e.jsx(j,{bookReading:s,size:"xs"})]})]},t.isbn13)}async function G(s){return(await f.post("/import",s,{headers:{Authorization:`Bearer ${v()}`}})).data}const L={importStoryGraph:G},F=()=>y({mutationFn:L.importStoryGraph,onSuccess:()=>{console.log("Started import from StoryGraph.")}});function B(){const s=F(),[t,a]=h.useState(""),[r,o]=h.useState(""),n=async l=>{var x;const d=(x=l.target.files)==null?void 0:x[0];if(a(""),!d){a("No file selected.");return}if(d.type!=="text/csv"){a("Invalid file type. Please select a .csv file.");return}const u=await s.mutateAsync(d);u?o(`Import has started, here is your import ID: ${u.import_id}. Your books will appear over time.`):a("Something went wrong when importing from story graph.")};return e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:".csv",style:{display:"none"},onChange:n,id:"fileInput"}),e.jsx("button",{className:"w-full border-2 rounded-md py-1 px-2 font-medium bg-slate-200 hover:bg-gray-200 transition duration-250",onClick:()=>{var l;return(l=document.getElementById("fileInput"))==null?void 0:l.click()},children:"Import from StoryGraph"}),t!==""?e.jsx(N,{errorMessage:t}):null,r!==""?e.jsx("div",{className:"text-green-700 text-sm",children:r}):null]})}const M=k("/")({component:Y});function Y(){var t;const{user:s}=i();return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("h1",{className:"text-xl text-center",children:["Welcome back, ",e.jsx("strong",{children:(t=s.data)==null?void 0:t.handle}),"! ðŸ‘‹"]}),e.jsx($,{}),e.jsx(I,{}),e.jsx(S,{}),e.jsx("hr",{}),e.jsx(B,{}),e.jsx("hr",{}),e.jsx(w,{})]})}export{M as Route};
