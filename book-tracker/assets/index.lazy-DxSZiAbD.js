import{u as h,j as e,a as d,r as c,L as m,S as g,b as p,R as f,c as b,f as j,d as v,F as y,e as N}from"./index-CM-pMqeH.js";function w(){const t=h();return e.jsx("button",{className:"border-2 rounded-md py-1 px-2 font-medium bg-slate-200 hover:bg-gray-200 transition duration-250",onClick:()=>t.mutate(),children:"Logout"})}function S(){const{haveRead:t}=d(),[a,o]=c.useState({}),s=r=>{o(l=>({...l,[r]:!0}))};return e.jsxs("div",{className:"border rounded-md",children:[e.jsxs("h2",{className:"text-lg font-medium bg-slate-200 p-2",children:["You have read ",t.data?`${t.data.length} books`:null]}),t.data&&t.data.length>0?e.jsx("div",{className:"grid grid-cols-2 xxxs:grid-cols-3 xxs:grid-cols-4 xs:grid-cols-4 sm:grid-cols-6 md:grid-cols-7 gap-2 p-2",children:t.data.map((r,l)=>k(r,l,a[r.book.isbn13],s))}):e.jsx("div",{className:"p-2",children:"You have not added any of the books you have read."})]})}function k(t,a,o,s){const{book:r,review:l}=t,n=new Date(l.read_date).toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"});return e.jsxs("div",{className:"flex gap-1 flex-col items-center",children:[e.jsx(m,{to:"/book/$isbn",params:{isbn:r.isbn13},className:"flex items-center h-28",children:o||!r.coverUrl?e.jsx("div",{className:"w-20 max-w-20 h-full border-2 flex items-center justify-center text-xs text-center p-2 overflow-hidden",children:r.title}):e.jsx("img",{src:r.coverUrl,title:r.title,alt:r.title,className:"w-20 max-w-20 h-full object-scale-down",onError:()=>s(r.isbn13)})}),l.rating&&l.rating>0?e.jsx(g,{rating:l.rating||0,overrideStarClass:"w-4 h-4"}):null,e.jsx("p",{className:"text-xs text-gray-400 mt-auto",children:n})]},a)}function E(){const{toRead:t}=d(),a=p(),[o,s]=c.useState({}),r=()=>{const n=t.data;if(!n)return;const i=n[Math.floor(Math.random()*n.length)];a({to:"/book/$isbn",params:{isbn:i.isbn13}})},l=n=>{s(i=>({...i,[n]:!0}))};return e.jsxs("div",{className:"border rounded-md",children:[e.jsxs("h2",{className:"text-lg font-medium bg-slate-200 p-2",children:["You want to read ",t.data?`${t.data.length} books`:null,t.data&&t.data.length>0?e.jsxs(e.Fragment,{children:[" ",e.jsx("button",{onClick:r,children:"ðŸŽ²"})]}):null]}),t.data&&t.data.length>0?e.jsx("div",{className:"flex items-center gap-2 p-2 overflow-x-auto overflow-y-hidden",children:t.data.map(n=>I(n,o[n.isbn13],l))}):e.jsx("div",{className:"p-2",children:"You have not added any books to be read."})]})}function I(t,a,o){return e.jsx(m,{to:"/book/$isbn",params:{isbn:t.isbn13},className:"flex items-center h-28",children:a||!t.coverUrl?e.jsx("div",{className:"w-20 max-w-20 h-full border-2 flex items-center justify-center text-xs text-center p-2 overflow-hidden",children:t.title}):e.jsx("img",{src:t.coverUrl,title:t.title,alt:t.title,className:"w-20 max-w-20 h-full object-scale-down",onError:()=>o(t.isbn13)})},t.isbn13)}function R(){const{reading:t}=d(),[a,o]=c.useState({}),s=r=>{o(l=>({...l,[r]:!0}))};return e.jsxs("div",{className:"border rounded-md",children:[e.jsxs("h2",{className:"text-lg font-medium bg-slate-200 p-2",children:["You are reading ",t.data?`${t.data.length} books`:null]}),t.data&&t.data.length>0?e.jsx("div",{className:"flex flex-col gap-2 p-2",children:t.data.map(r=>$(r,a[r.book.isbn13],s))}):e.jsx("div",{className:"p-2",children:"Currently not reading any books..."})]})}function $(t,a,o){const{book:s}=t;return e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(m,{to:"/book/$isbn",params:{isbn:s.isbn13},className:"basis-1/5 h-32",children:a||!s.coverUrl?e.jsx("div",{className:"w-20 max-w-20 h-full border-2 flex items-center justify-center text-xs text-center p-2 overflow-hidden",children:s.title}):e.jsx("img",{src:s.coverUrl,title:s.title,alt:s.title,className:"w-20 max-w-20 h-full object-scale-down m-auto",onError:()=>o(s.isbn13)})}),e.jsxs("div",{className:"flex flex-col grow basis-4/5",children:[e.jsx("h3",{className:"text-md",children:s.title}),e.jsx("h4",{className:"text-sm mb-1",children:s.authors.join(",")}),e.jsx(f,{bookReading:t,size:"xs"})]})]},s.isbn13)}async function C(t){return(await b.post("/import",t,{headers:{Authorization:`Bearer ${j()}`}})).data}const G={importStoryGraph:C},L=()=>v({mutationFn:G.importStoryGraph,onSuccess:()=>{console.log("Started import from StoryGraph.")}});function U(){const t=L(),[a,o]=c.useState(""),[s,r]=c.useState(""),l=async n=>{var u;const i=(u=n.target.files)==null?void 0:u[0];if(o(""),!i){o("No file selected.");return}if(i.type!=="text/csv"){o("Invalid file type. Please select a .csv file.");return}const x=await t.mutateAsync(i);x?r(`Import has started, here is your import ID: ${x.import_id}. Your books will appear over time.`):o("Something went wrong when importing from story graph.")};return e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:".csv",style:{display:"none"},onChange:l,id:"fileInput"}),e.jsx("button",{className:"w-full border-2 rounded-md py-1 px-2 font-medium bg-slate-200 hover:bg-gray-200 transition duration-250",onClick:()=>{var n;return(n=document.getElementById("fileInput"))==null?void 0:n.click()},children:"Import from StoryGraph"}),a!==""?e.jsx(y,{errorMessage:a}):null,s!==""?e.jsx("div",{className:"text-green-700 text-sm",children:s}):null]})}const Y=N("/")({component:B});function B(){var a;const{user:t}=d();return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("h1",{className:"text-xl text-center",children:["Welcome back, ",e.jsx("strong",{children:(a=t.data)==null?void 0:a.handle}),"! ðŸ‘‹"]}),e.jsx(R,{}),e.jsx(E,{}),e.jsx(S,{}),e.jsx("hr",{}),e.jsx(U,{}),e.jsx("hr",{}),e.jsx(w,{})]})}export{Y as Route};
