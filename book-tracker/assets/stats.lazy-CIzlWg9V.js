import{a as S,f as D,u as w,r as m,j as t,c as N}from"./index-ClHgrMfG.js";async function k(e){return(await S.get("/stats/general",{params:{start:e.start,end:e.end},headers:{Authorization:`Bearer ${D()}`}})).data}async function O(e){return(await S.get("/stats/reading-graph",{params:{start:e.start,end:e.end},headers:{Authorization:`Bearer ${D()}`}})).data}const v={getGeneralStats:k,getReadingGraph:O},G=()=>e=>w({queryKey:[`stats-general-${e.start}-${e.end}`],queryFn:()=>v.getGeneralStats(e)}),R=()=>e=>w({queryKey:[`stats-reading-graph-${e.start}-${e.end}`],queryFn:()=>v.getReadingGraph(e)});function C({start:e,end:a}){const o=R()({start:e,end:a}),u=new Date(e),c=new Date(a),[i,f]=m.useState(null),l={},d={Sun:[],Mon:[],Tue:[],Wed:[],Thu:[],Fri:[],Sat:[]};if(o.data&&!o.isFetching&&!o.isLoading){const r=o.data.min,s=o.data.max,x=new Date;for(let n=u;n<=c;n.setDate(n.getDate()+1)){const p=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][n.getDay()],y=n.toISOString().split("T")[0],h=o.data.days[y];let j=0;h>0&&(j=Math.ceil((h-r)/(s-r)*5),j=Math.max(1,Math.min(5,j))),d[p].push({date:y,intensity:j,pages:h||0,isToday:x.toDateString()===n.toDateString()})}for(let n=0;n<d.Sun.length;n++){const p=new Date(d.Sun[n].date),h=`${p.toLocaleString("default",{month:"short"})}-${p.getFullYear()}`;l[h]=l[h]?l[h]+1:1}}else return t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-bold",children:"Reading Graph"}),t.jsx("div",{children:"Loading..."})]});const b=(r,s,x)=>{const{clientX:n,clientY:p}=r;f({date:s,dateObj:new Date(s),pages:x,x:n,y:p})};return t.jsxs("div",{children:[t.jsxs("h2",{className:"text-lg font-bold",children:["Reading Graph ",o.data.total?`- ${o.data.total} pages`:""]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"table-fixed",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("td",{}),Object.keys(l).map(r=>t.jsx("td",{className:"text-sm",colSpan:l[r],children:r.split("-")[0]},r))]})}),t.jsx("tbody",{children:Object.keys(d).map(r=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-sm min-h-6 h-6 pr-1",children:r}),d[r].map((s,x)=>t.jsxs(m.Fragment,{children:[x===0&&L(s.date,r,d)?t.jsx("td",{}):null,t.jsx("td",{className:`min-w-6 w-6 p-0 border ${F(s.intensity,s.isToday)}`,title:s.date,onClick:n=>b(n,s.date,s.pages)})]},x))]},r))})]})}),i&&t.jsxs("div",{className:"absolute bg-white border rounded p-2",style:{top:i.y+10,left:i.x+10,zIndex:1e3},children:[t.jsx("h3",{className:"text-sm font-semibold",children:i.dateObj.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),t.jsxs("p",{className:"text-sm",children:[i.pages," Pages"]})]})]})}function L(e,a,g){const o=new Date(e),u=Object.keys(g).indexOf(a);for(let c=u;c<Object.keys(g).length;c++){const i=new Date(g[Object.keys(g)[c]][0].date);if(o.getTime()>i.getTime())return!0}return!1}function F(e,a){return e===1?a?"bg-emerald-100":"bg-cyan-100":e===2?a?"bg-emerald-200":"bg-cyan-200":e===3?a?"bg-emerald-300":"bg-cyan-300":e===4?a?"bg-emerald-400":"bg-cyan-400":e===5?a?"bg-emerald-500":"bg-cyan-500":a?"bg-emerald-50":""}const T=N("/stats")({component:I});function I(){var b,r;const e=new Date().getFullYear(),[a,g]=m.useState(new Date(e,0,1).toISOString().split("T")[0]),[o,u]=m.useState(new Date(e,11,31).toISOString().split("T")[0]),[c,i]=m.useState({start:a,end:o}),l=G()(c),d=s=>{const x=new Date,n=new Date(x.setMonth(x.getMonth()-s));g(n.toISOString().split("T")[0]),u(new Date().toISOString().split("T")[0]),i({start:n.toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]})};return t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl text-center",children:"Your Statistics"}),t.jsx("hr",{}),t.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"date",value:a,onChange:s=>g(s.target.value),className:"w-full text-xs border-2 rounded-md py-1 px-2 focus:border-gray-200 h-[34px]"}),t.jsx("div",{className:"text-gray-400 text-sm",children:"â†’"}),t.jsx("input",{type:"date",value:o,onChange:s=>u(s.target.value),className:"w-full text-xs border-2 rounded-md py-1 px-2 focus:border-gray-200 h-[34px]"}),t.jsx("button",{onClick:()=>i({start:a,end:o}),className:"w-full text-xs border-2 rounded-md py-1 px-2 bg-white hover:bg-gray-200 transition duration-250 h-[34px]",children:"Update"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>d(1),className:"flex-1 text-xs border-2 rounded-md py-1 px-2 bg-white hover:bg-gray-200 transition duration-250",children:"Last Month"}),t.jsx("button",{onClick:()=>d(3),className:"flex-1 text-xs border-2 rounded-md py-1 px-2 bg-white hover:bg-gray-200 transition duration-250",children:"Last 3 Months"}),t.jsx("button",{onClick:()=>d(6),className:"flex-1 text-xs border-2 rounded-md py-1 px-2 bg-white hover:bg-gray-200 transition duration-250",children:"Last 6 Months"}),t.jsx("button",{onClick:()=>d(12),className:"flex-1 text-xs border-2 rounded-md py-1 px-2 bg-white hover:bg-gray-200 transition duration-250",children:"Last Year"})]}),l.isLoading||l.isFetching?t.jsx("div",{children:"Loading..."}):(b=l.data)!=null&&b.total_books&&((r=l.data)!=null&&r.total_pages)?t.jsxs("div",{children:[t.jsxs("div",{className:"flex text-center items-center gap-2",children:[t.jsxs("p",{className:"w-full",children:["Books ",t.jsx("strong",{children:l.data.total_books})]}),t.jsxs("p",{className:"w-full",children:["Pages ",t.jsx("strong",{children:l.data.total_pages})]})]}),t.jsx("p",{className:"text-sm text-center",children:t.jsx("i",{children:"page count may be inaccurate due to book data quality"})})]}):null]}),t.jsx("br",{}),t.jsx("div",{className:"flex flex-col gap-2",children:t.jsx(C,{start:c.start,end:c.end})})]})}export{T as Route};
